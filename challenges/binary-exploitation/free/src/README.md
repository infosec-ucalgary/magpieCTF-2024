# free
### Category: Binary Exploitation Medium
### Author: Christina

## Description


## Hints


## Solution
This challenge consists of two vulnerabilities
The first part is an integer overflow vulnerability.
1. By obervation, get_safe_uint will return a positive integer within the boundary of maximum integer size. However, in case 4, when we purchase product, price*amount will overflow the integer giving us.
2. In this challenge, we are required to overflow the integer to the exact number: -1 to unlock the developer feature. 
3. There is a pattern on how the integer is wrapped around. We know that maximum positive int in c is 2147483647 and minimum int in c is -2147483648 with 1 bit indicating the sign. So, to wrap around, we need to add 2*2147483648*n, where n is an integer.  
4. In our case, we are subtracting amount*price. Given price, we want to find an amount that would result in -1. This can be calculated as -2147483648*2n-1=price*amount. This is essentially reduced to finding an n such that 2147483648*2n+1 is a multiple of price. We can do this by brute force.
5. A simple python script to brute force amount would be:
```
def find_amount(price):
    for i in range(10):
        if (2147483648*2*i+1) %price==0:
            print((2147483648*2*i+1)/price)
            break
```



The second part of this challenge is an use after free vulnerability.

This part is inspired by a challenge on root-me:
https://www.root-me.org/en/Challenges/App-System/ELF-x64-Double-free?tri_co=note_ponderee

1. After unlocking the developer feature, we can remove a product from the list.
2. Also by observation, the custom structure ACCOUNT and PRODUCT share the same size.
3. By removing a product, we release the chunk to tcache bin.
4. Then when we create an account, the chunk is reused and get_scret is at the same location as see_review.
5. Since the product's reference is still accessible, we are able to call get_secret through see_review.



## Flag
magpie{f10w1ng_m0n3y_1n_fr33_bug5}
