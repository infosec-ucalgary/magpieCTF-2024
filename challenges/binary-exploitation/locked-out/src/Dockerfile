FROM nsjailcontainer

ARG USERNAME=magpie
RUN useradd -m $USERNAME
RUN chmod a-w /home/$USERNAME

COPY locked_out.c /home/magpie
COPY pass.txt /home/magpie
COPY flag.txt /home/magpie

RUN chmod o+x /home/$USERNAME
RUN gcc -o /home/magpie/locked_out /home/magpie/locked_out.c -w -fno-stack-protector -no-pie 

EXPOSE 7329

RUN rm /home/magpie/locked_out.c
CMD ["bin/nsjail", "-Ml", "--hostname", "localhost", "--port", "7329","--user", "1001", "--group", "1001", "--chroot", "/", "-E", "TERM=xterm", "--cwd", "/home/magpie", "--","/home/magpie/locked_out"]


